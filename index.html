<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0f14" />
  <title>Stone Tracker</title>

  <style>
    :root{
      --bg:#0b0f14;
      --card:#121a24;
      --border:#243244;
      --text:#f5f7fb;
      --muted:#b9c2cf;
      --accent:#7dd3fc;
      --danger:#fb7185;
      --shadow:0 10px 30px rgba(0,0,0,.45);
      --r:18px;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:var(--bg);
      color:var(--text);
      padding:18px;
    }

    .wrap{max-width:820px;margin:auto}

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:18px;
    }

    .stone-id{
      font-size:32px;
      font-weight:900;
      margin-bottom:14px;
      letter-spacing:.5px;
    }

    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }

    @media (min-width:640px){
      .grid{grid-template-columns:1fr 1fr;}
    }

    .kv{
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      background:rgba(0,0,0,.2);
    }

    .k{
      font-size:12px;
      text-transform:uppercase;
      color:var(--muted);
      margin-bottom:6px;
      letter-spacing:.08em;
    }

    .v{
      font-size:20px;
      font-weight:800;
      word-break:break-word;
    }

    .notes{
      margin-top:14px;
      border-top:1px dashed rgba(255,255,255,.15);
      padding-top:12px;
      font-size:16px;
      line-height:1.4;
    }

    .photos{
      margin-top:12px;
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:10px;
    }

    @media(min-width:640px){
      .photos{grid-template-columns:repeat(3,1fr);}
    }

    .photos img{
      width:100%;
      height:140px;
      object-fit:cover;
      border-radius:12px;
      border:1px solid var(--border);
    }

    .status{
      padding:12px;
      border-radius:12px;
      border-left:4px solid var(--accent);
      background:rgba(125,211,252,.1);
      margin-bottom:14px;
    }

    .error{
      border-left-color:var(--danger);
      background:rgba(251,113,133,.1);
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div id="status" class="status">Loading stone...</div>

    <div id="stoneView" style="display:none;">
      <div class="stone-id" id="stoneId"></div>

      <div class="grid">
        <div class="kv">
          <div class="k">Weight</div>
          <div class="v" id="weight"></div>
        </div>

        <div class="kv">
          <div class="k">Date Weighed</div>
          <div class="v" id="dateWeighed"></div>
        </div>

        <div class="kv">
          <div class="k">Location</div>
          <div class="v" id="location"></div>
        </div>

        <div class="kv">
          <div class="k">Last Updated</div>
          <div class="v" id="updated"></div>
        </div>
      </div>

      <div id="notesWrap" class="notes" style="display:none;">
        <div class="k">Notes</div>
        <div id="notes"></div>
      </div>

      <div id="photosWrap" class="photos" style="display:none;"></div>
    </div>
  </div>
</div>

<script>
const params = new URLSearchParams(location.search);
const stoneId = (params.get("id") || "").trim().toUpperCase();

async function loadStone(){
  if(!stoneId){
    showError("No stone ID in URL.");
    return;
  }

  try{
    const res = await fetch("./stones.json", {cache:"no-store"});
    const data = await res.json();
    const list = data.stones || [];
    const stone = list.find(s => s.id.toUpperCase() === stoneId);

    if(!stone){
      showError("Stone not found: " + stoneId);
      return;
    }

    document.getElementById("status").style.display = "none";
    document.getElementById("stoneView").style.display = "block";

    document.getElementById("stoneId").textContent = stone.id;
    document.getElementById("weight").textContent =
      Number(stone.weight_lbs).toLocaleString() + " lbs";
    document.getElementById("dateWeighed").textContent =
      stone.date_weighed || "-";
    document.getElementById("location").textContent =
      stone.location || "-";
    document.getElementById("updated").textContent =
      stone.updated_at || "-";

    if(stone.notes){
      document.getElementById("notesWrap").style.display = "block";
      document.getElementById("notes").textContent = stone.notes;
    }

    if(stone.photos && stone.photos.length){
      const wrap = document.getElementById("photosWrap");
      wrap.style.display = "grid";
      stone.photos.forEach(url => {
        const img = document.createElement("img");
        img.src = url;
        wrap.appendChild(img);
      });
    }

  } catch(e){
    showError("Error loading data.");
  }
}

function showError(msg){
  const status = document.getElementById("status");
  status.classList.add("error");
  status.textContent = msg;
}

loadStone();
</script>
</body>
</html>
